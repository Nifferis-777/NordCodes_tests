# Задание: покрыть тестами java-приложение, представляющее собой классический веб-сервис на Spring Boot. 

## Запуск приложения осуществляется следующей командой:

```

java -jar -Dsecret=qazWSXedc -Dmock=http://localhost:8888/ internal-0.0.1-SNAPSHOT.jar 
 
```

## Используемый стек технологий:

1) ` Java `

2) ` Maven `

3) ` JUnit5 ` 

4) ` WireMock `

5) ` RestAssured `

6) ` Allure ` 

## Описание структуры

У тестируемого приложения только один эндпоинт, который принимает на вход POST-запросы вида:
```
POST http://localhost:8080/endpoint
Content-Type: application/x-www-form-urlencoded
Accept: application/json
X-Api-Key: qazWSXedc

token=${token}&action=${action}
```
Для доступа к эндпоинту требуется заголовок `X-Api-Key`.  
Это статический API-ключ, который проверяется приложением при каждом запросе.

token - строка длиной 32 символа, состоящая только из символов A-Z0-9
action - действие пользователя. Всего их три:
* LOGIN - аутентификация. Триггерит отправку запроса /auth на внешний сервис. В случае успеха токен сохраняется во внутреннем хранилище
* ACTION - действие. Триггерит отправку запроса /doAction на внешний сервис. Доступно только для токенов, ранее прошедших LOGIN
* LOGOUT - завершение сессии юзера. Удаляет токен из внутреннего хранилища
В ответ приходит json.

### Эндпоинты внешнего сервиса

У внешнего сервиса только два эндпоинта. На них отправляет запросы тестируемое приложение.
Оба могут возвращать любое тело ответа, тестируемое приложение смотрит только на код.

## Краткое описание реализации проекта

Проект с тестами расположен в директории ` src/test/api_tests `:
1) Директория ` client ` содержит класс ` ApiClient `. Данный класс представляет собой клиент для выполнения API-запросов: методы POST с настройкой заголовков, параметров, валидацией ответов и поддержкой разных HTTP-методов.
2) Директория ` constants ` содержит класс ` ApiConstants `. Данный класс содержит константы для API-тестов: названия действий, эндпоинты, HTTP-заголовки, параметры запросов, поля ответов и статус-коды.
3) Класс ` BaseApiTest ` - это базовый класс для API тестов. Настраивает WireMock сервер для мокинга внешнего сервиса.
4) Класс ` NegativeTests ` - содержит негативные сценарии тестов.
5) Класс ` PositiveTests ` - содержит позитивные сценарии тестов.
6) Класс ` ServerUnavailableTests ` - содержит сценарии тестов, когда сервер недоступен. По умолчанию - тесты отключены. Прогонять их необходимо в случае недоступности сервера.
7) Директория ` configs ` содержит:
* ` LoaderConfig ` - класс с конфигурацией для загрузки параметров тестирования из properties файла.
* ` WireMockConfig ` - класс с конфигурацией стабов для WireMock сервера.
* ` WireMockExtension ` - класс с JUnit5 Extension для управления жизненным циклом WireMock сервера.
8) В директории ` resources ` расположен файл test_params.properties с тестовыми данными.

## Запуск тестов

Запуск тестов через консоль IDE осуществляется посредством использования нижеуказанных команд.

Для запуска всех api-тестов использовать команду:

```

mvn clean test  

```

- Для запуска только позитивных api-тестов использовать команду:

```

mvn clean test -Dgroups=Positive_tests
 
```

- Для запуска только негативных api-тестов использовать команду:

```

mvn clean test -Dgroups=Negative_tests

```
- Для запуска тестов при недоступном сервере использовать команду:

```

mvn clean test -Dgroups=Server_unavailable_tests

```

## Формирование Allure-отчета после прогона тестов и его просмотр

Для того чтобы сформировать Allure-отчет после прогона тестов, необходимо предварительно установить на локальном компьютере allure, а затем выполнить в консоли IDE следующую команду:

```

allure serve

```
В открывшемся отчете перейти в определенную вкладку, например "Behaviors". В ней отображаются подробные "читаемые" отчеты о прохождении тестов.




